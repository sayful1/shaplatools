!function(e){e.extend(e.fn,{livequery:function(t,i,n){var o=this,r;return e.isFunction(t)&&(n=i,i=t,t=void 0),e.each(e.livequery.queries,function(e,s){if(!(o.selector!=s.selector||o.context!=s.context||t!=s.type||i&&i.$lqguid!=s.fn.$lqguid||n&&n.$lqguid!=s.fn2.$lqguid))return(r=s)&&!1}),r=r||new e.livequery(this.selector,this.context,t,i,n),r.stopped=!1,r.run(),this},expire:function(t,i,n){var o=this;return e.isFunction(t)&&(n=i,i=t,t=void 0),e.each(e.livequery.queries,function(r,s){o.selector!=s.selector||o.context!=s.context||t&&t!=s.type||i&&i.$lqguid!=s.fn.$lqguid||n&&n.$lqguid!=s.fn2.$lqguid||this.stopped||e.livequery.stop(s.id)}),this}}),e.livequery=function(t,i,n,o,r){return this.selector=t,this.context=i,this.type=n,this.fn=o,this.fn2=r,this.elements=[],this.stopped=!1,this.id=e.livequery.queries.push(this)-1,o.$lqguid=o.$lqguid||e.livequery.guid++,r&&(r.$lqguid=r.$lqguid||e.livequery.guid++),this},e.livequery.prototype={stop:function(){var e=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(t,i){e.fn2.apply(i)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var t=this,i=this.elements,n=e(this.selector,this.context),o=n.not(i);this.elements=n,this.type?(o.bind(this.type,this.fn),i.length>0&&e.each(i,function(i,o){e.inArray(o,n)<0&&e.event.remove(o,t.type,t.fn)})):(o.each(function(){t.fn.apply(this)}),this.fn2&&i.length>0&&e.each(i,function(i,o){e.inArray(o,n)<0&&t.fn2.apply(o)}))}}},e.extend(e.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(e.livequery.running&&e.livequery.queue.length)for(var t=e.livequery.queue.length;t--;)e.livequery.queries[e.livequery.queue.shift()].run()},pause:function(){e.livequery.running=!1},play:function(){e.livequery.running=!0,e.livequery.run()},registerPlugin:function(){e.each(arguments,function(t,i){if(e.fn[i]){var n=e.fn[i];e.fn[i]=function(){var t=n.apply(this,arguments);return e.livequery.run(),t}}})},run:function(t){void 0!=t?e.inArray(t,e.livequery.queue)<0&&e.livequery.queue.push(t):e.each(e.livequery.queries,function(t){e.inArray(t,e.livequery.queue)<0&&e.livequery.queue.push(t)}),e.livequery.timeout&&clearTimeout(e.livequery.timeout),e.livequery.timeout=setTimeout(e.livequery.checkQueue,20)},stop:function(t){void 0!=t?e.livequery.queries[t].stop():e.each(e.livequery.queries,function(t){e.livequery.queries[t].stop()})}}),e.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),e(function(){e.livequery.play()})}(jQuery),jQuery.fn.appendo=function(e){return this.each(function(){jQuery.appendo.init(this,e)}),this},jQuery.appendo=function(){var e=this;return this.opt={},this.init=function(t,i){function n(){var e=d.clone(l.copyHandlers);e.appendTo(t),r(1),"function"==typeof l.onAdd&&l.onAdd(e),l.focusFirst&&e.find("input:first").focus()}function o(){var e=jQuery(t).find(l.subSelect);("function"!=typeof l.onDel||l.onDel(e))&&(e.remove(),r(-1))}function r(e){h+=e||0,l.allowDelete&&h>1?f.show():f.hide()}function s(e){return jQuery("<button />").css(l.buttonStyle).html(e)}function a(e){return e.stopPropagation(),e.preventDefault(),!1}function u(e){return(!l.maxRows||h<l.maxRows)&&n(),a(e)}function c(e){return h>1&&o(),a(e)}var l=jQuery.extend({labelAdd:"Add Row",labelDel:"Remove",allowDelete:!0,copyHandlers:!1,focusFirst:!0,onAdd:function(){return!0},onDel:function(){return!0},maxRows:0,wrapClass:"appendoButtons",wrapStyle:{padding:".4em .2em .5em"},buttonStyle:{marginRight:".5em"},subSelect:"tr:last"},e.opt,i),d=jQuery(t).find(l.subSelect).clone(l.copyHandlers),h=1,p=jQuery("#form-child-add").click(u),f=s(l.labelDel).click(c).hide();r()},this}();var FontAwesomeIcons;!function($){"use strict";FontAwesomeIcons=function(){var e="";return $.each(stIconObj.fontawesome,function(t,i){e+='<span class="icon-category">'+t+"</span>",i.map(function(t){e+='<i class="'+t.style+" fa-"+t.id+'" data-icon-id="'+t.id+'" data-style="'+t.style+'"></i>'})}),e}}(jQuery),jQuery(document).ready(function($){var e={loadVals:function(){var e=$("#_shapla_shortcode").text(),t=e;$(".shapla-input").each(function(){var e=$(this),i=e.attr("id"),i=i.replace("shapla_",""),n=new RegExp("{{"+i+"}}","g");t=t.replace(n,e.val())}),$("#_shapla_ushortcode").remove(),$("#shapla-sc-form-table").prepend('<div id="_shapla_ushortcode" class="hidden">'+t+"</div>")},cLoadVals:function(){var e=$("#_shapla_cshortcode").text(),t="";shortcodes="",$(".child-clone-row").each(function(){var t=$(this),i=e;$(".shapla-cinput",this).each(function(){var e=$(this),t=e.attr("id"),t=t.replace("shapla_","");re=new RegExp("{{"+t+"}}","g"),i=i.replace(re,e.val())}),shortcodes=shortcodes+i+"\n"}),$("#_shapla_cshortcodes").remove(),$(".child-clone-rows").prepend('<div id="_shapla_cshortcodes" class="hidden">'+shortcodes+"</div>"),this.loadVals(),t=$("#_shapla_ushortcode").text().replace("{{child_shortcode}}",shortcodes),$("#_shapla_ushortcode").remove(),$("#shapla-sc-form-table").prepend('<div id="_shapla_ushortcode" class="hidden">'+t+"</div>")},children:function(){$(".child-clone-rows").appendo({subSelect:"> div.child-clone-row:last-child",allowDelete:!1,focusFirst:!1}),$(".child-clone-row-remove").live("click",function(){var e=$(this),t=e.parent();return $(".child-clone-row").size()>1?t.remove():alert("You need a minimum of one row"),!1}),$(".child-clone-rows").sortable({placeholder:"sortable-placeholder",items:".child-clone-row"})},resizeTB:function(){var e=$("#TB_ajaxContent"),t=$("#TB_window"),i=$("#shapla-popup");t.css({height:i.outerHeight(),width:i.outerWidth(),marginLeft:-i.outerWidth()/2,maxHeight:"85%",overflowY:"scroll"}),e.css({paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:0,height:t.outerHeight(),overflow:"auto",width:i.outerWidth()}),$("#shapla-popup").addClass("no_preview")},media:function(){var e,t,i=$(".shapla-open-media");"image"===i.data("type")?t=StagShortcodes.media_frame_image_title:"video"===i.data("type")&&(t=StagShortcodes.media_frame_video_title),i.on("click",function(n){if(n.preventDefault(),e)return void e.open();e=wp.media.frames.shapla_media_frame=wp.media({className:"media-frame shapla-media-frame",frame:"select",multiple:!1,title:t,library:{type:i.data("type")},button:{text:i.data("text")}}),e.on("select",function(){var t=e.state().get("selection").first().toJSON();$("#shapla_src").val(t.url),$(".shapla-input").trigger("change")}),e.open()})},load:function(){var e=this,t=$("#TB_window"),i=$("#shapla-popup"),n=$("#shapla-sc-form",i),o=$("#_shapla_shortcode",n).text(),r=$("#_shapla_popup",n).text(),s="",a=$(".shapla-all-icons").find("i");$("#close-popup").on("click",function(){tb_remove()}),e.resizeTB(),$(window).resize(function(){e.resizeTB()}),t.css({border:"none"}),t.find("#TB_title").remove(),e.loadVals(),e.children(),e.cLoadVals(),e.media(),$(".shapla-cinput",n).live("change",function(){e.cLoadVals()}),$(".shapla-input",n).live("change",function(){e.loadVals()});var u=$(".shapla-all-icons");u.append(FontAwesomeIcons()),u.on("click","i",function(e){u.find("i").removeClass("active-icon"),$(this).addClass("active-icon"),$("#shapla_icon").val($(this).data("icon-id")),$("#shapla_style").val($(this).data("style")),$(".shapla-input").trigger("change")}),$(".shapla-control-buttonset").buttonset(),$(".shapla-control-buttonset").on("change","input",function(e){var t=$(this).data("key");$("#"+t).val($(this).val()),$(".shapla-input").trigger("change")}),$(".shapla-insert",n).click(function(){if(window.tinyMCE){var e=tinyMCE.majorVersion;"3"===e?(window.tinyMCE.execInstanceCommand(window.tinyMCE.activeEditor.id,"mceInsertContent",!1,$("#_shapla_ushortcode",n).html()),tb_remove()):"4"===e&&(window.tinyMCE.activeEditor.insertContent($("#_shapla_ushortcode",n).html()),tb_remove())}})}};$("#shapla-popup").livequery(function(){e.load()})});